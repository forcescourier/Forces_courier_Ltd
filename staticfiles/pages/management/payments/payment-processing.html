<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Payment Processing - Courier Management System</title>
    <link rel="icon" type="image/png" sizes="16x16" href="../../../assets/images/favicon.png">
    <link href="../../../vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet">
    <link href="../../../vendor/datatables/css/jquery.dataTables.min.css" rel="stylesheet">
    <link href="../../../assets/css/style.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <style>
        .live-transaction {
            animation: fadeIn 0.5s ease-in;
            border-left: 4px solid #007bff;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .processing-indicator {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .status-processing { color: #ffc107; }
        .status-success { color: #28a745; }
        .status-failed { color: #dc3545; }
        .realtime-chart {
            height: 300px;
        }
        .transaction-feed {
            max-height: 400px;
            overflow-y: auto;
        }
        .auto-refresh {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1050;
        }
    </style>
</head>
<body>
    <div id="preloader">
        <div class="sk-three-bounce">
            <div class="sk-child sk-bounce1"></div>
            <div class="sk-child sk-bounce2"></div>
            <div class="sk-child sk-bounce3"></div>
        </div>
    </div>

    <div id="main-wrapper">
        <div class="nav-header">
            <a href="../../../index.html" class="brand-logo">
                <img class="logo-abbr" src="../../../assets/images/logo.png" alt="">
                <img class="logo-compact" src="../../../assets/images/logo-text.png" alt="">
                <img class="brand-title" src="../../../assets/images/logo-text.png" alt="">
            </a>
            <div class="nav-control">
                <div class="hamburger">
                    <span class="line"></span><span class="line"></span><span class="line"></span>
                </div>
            </div>
        </div>

        <div class="header">
            <div class="header-content">
                <nav class="navbar navbar-expand">
                    <div class="collapse navbar-collapse justify-content-between">
                        <div class="header-left">
                            <div class="dashboard_bar">Payment Processing</div>
                        </div>
                        <ul class="navbar-nav header-right">
                            <li class="nav-item dropdown header-profile">
                                <a class="nav-link" href="#" role="button" data-toggle="dropdown">
                                    <img src="../../../assets/images/profile/1.jpg" width="20" alt="">
                                    <div class="header-info">
                                        <span class="text-black"><strong>Admin User</strong></span>
                                        <p class="mb-0 fs-12">Administrator</p>
                                    </div>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a href="../../../profile.html" class="dropdown-item ai-icon">
                                        <i class="flaticon-381-user"></i>
                                        <span class="ml-2">Profile</span>
                                    </a>
                                    <a href="../../authentication/logout.html" class="dropdown-item ai-icon">
                                        <i class="flaticon-381-exit"></i>
                                        <span class="ml-2">Logout</span>
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>

        <div class="deznav">
            <div class="deznav-scroll">
                <ul class="metismenu" id="menu">
                    <li><a href="../../../index.html" class="ai-icon" aria-expanded="false">
                            <i class="flaticon-381-networking"></i>
                            <span class="nav-text">Dashboard</span>
                        </a></li>
                    <li><a href="../parcels/parcels.html" class="ai-icon" aria-expanded="false">
                            <i class="flaticon-381-box"></i>
                            <span class="nav-text">Parcels</span>
                        </a></li>
                    <li><a href="../merchants/merchants.html" class="ai-icon" aria-expanded="false">
                            <i class="flaticon-381-user-7"></i>
                            <span class="nav-text">Merchants</span>
                        </a></li>
                    <li><a href="../riders/riders.html" class="ai-icon" aria-expanded="false">
                            <i class="flaticon-381-bike"></i>
                            <span class="nav-text">Riders</span>
                        </a></li>
                    <li><a href="../services/services.html" class="ai-icon" aria-expanded="false">
                            <i class="flaticon-381-list"></i>
                            <span class="nav-text">Services</span>
                        </a></li>
                    <li><a href="../areas/areas.html" class="ai-icon" aria-expanded="false">
                            <i class="flaticon-381-map"></i>
                            <span class="nav-text">Areas</span>
                        </a></li>
                    <li><a href="../payments/payments.html" class="ai-icon" aria-expanded="false">
                            <i class="flaticon-381-wallet"></i>
                            <span class="nav-text">Payments</span>
                        </a></li>
                    <li><a href="../invoices/invoices.html" class="ai-icon" aria-expanded="false">
                            <i class="flaticon-381-invoice"></i>
                            <span class="nav-text">Invoices</span>
                        </a></li>
                    <li><a href="../../reports/reports.html" class="ai-icon" aria-expanded="false">
                            <i class="flaticon-381-chart"></i>
                            <span class="nav-text">Reports</span>
                        </a></li>
                    <li><a href="../../../settings.html" class="ai-icon" aria-expanded="false">
                            <i class="flaticon-381-settings"></i>
                            <span class="nav-text">Settings</span>
                        </a></li>
                </ul>
            </div>
        </div>

        <!-- Auto Refresh Indicator -->
        <div class="auto-refresh">
            <div class="alert alert-info alert-dismissible fade show" role="alert">
                <i class="fas fa-sync-alt fa-spin mr-2"></i>Auto-refreshing every 10s
                <button type="button" class="close" data-dismiss="alert">
                    <span>&times;</span>
                </button>
            </div>
        </div>

        <div class="content-body">
            <div class="container-fluid">
                <div class="row page-titles mx-0">
                    <div class="col-sm-6 p-md-0">
                        <div class="welcome-text">
                            <h4>Payment Processing Dashboard</h4>
                            <span>Real-time payment monitoring and transaction processing</span>
                        </div>
                    </div>
                    <div class="col-sm-6 p-md-0 justify-content-sm-end mt-2 mt-sm-0 d-flex">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="javascript:void(0)">Home</a></li>
                            <li class="breadcrumb-item"><a href="../payments/payments.html">Payments</a></li>
                            <li class="breadcrumb-item active"><a href="javascript:void(0)">Processing</a></li>
                        </ol>
                    </div>
                </div>

                <!-- Real-time Stats -->
                <div class="row">
                    <div class="col-xl-3 col-lg-6 col-sm-6">
                        <div class="widget-stat card">
                            <div class="card-body p-4">
                                <div class="media ai-icon">
                                    <span class="mr-3 bgl-success ai-icon processing-indicator">
                                        <i class="fas fa-credit-card"></i>
                                    </span>
                                    <div class="media-body">
                                        <h3 class="mb-0 text-black" id="liveTransactions">47</h3>
                                        <p class="mb-0">Processing Now</p>
                                        <small class="text-success">Live transactions</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-6 col-sm-6">
                        <div class="widget-stat card">
                            <div class="card-body p-4">
                                <div class="media ai-icon">
                                    <span class="mr-3 bgl-primary ai-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </span>
                                    <div class="media-body">
                                        <h3 class="mb-0 text-black" id="todayVolume">৳1.2M</h3>
                                        <p class="mb-0">Today's Volume</p>
                                        <small class="text-info" id="volumeChange">+12.5% vs yesterday</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-6 col-sm-6">
                        <div class="widget-stat card">
                            <div class="card-body p-4">
                                <div class="media ai-icon">
                                    <span class="mr-3 bgl-warning ai-icon">
                                        <i class="fas fa-clock"></i>
                                    </span>
                                    <div class="media-body">
                                        <h3 class="mb-0 text-black" id="avgProcessTime">2.3s</h3>
                                        <p class="mb-0">Avg Process Time</p>
                                        <small class="text-success">Excellent</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-6 col-sm-6">
                        <div class="widget-stat card">
                            <div class="card-body p-4">
                                <div class="media ai-icon">
                                    <span class="mr-3 bgl-info ai-icon">
                                        <i class="fas fa-percentage"></i>
                                    </span>
                                    <div class="media-body">
                                        <h3 class="mb-0 text-black" id="successRate">98.7%</h3>
                                        <p class="mb-0">Success Rate</p>
                                        <small class="text-success">+0.3% today</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Processing Controls -->
                <div class="row">
                    <div class="col-xl-12">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title">Processing Controls</h4>
                                <div class="card-action">
                                    <button type="button" class="btn btn-info btn-sm mr-2" onclick="pauseProcessing()">
                                        <i class="fas fa-pause mr-2"></i>Pause Processing
                                    </button>
                                    <button type="button" class="btn btn-warning btn-sm mr-2" onclick="clearQueue()">
                                        <i class="fas fa-trash mr-2"></i>Clear Queue
                                    </button>
                                    <button type="button" class="btn btn-success btn-sm" onclick="forceProcess()">
                                        <i class="fas fa-play mr-2"></i>Force Process
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <h5 class="text-warning" id="queueCount">23</h5>
                                            <p class="mb-0">In Queue</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <h5 class="text-info" id="processingCount">12</h5>
                                            <p class="mb-0">Processing</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <h5 class="text-success" id="completedCount">1,156</h5>
                                            <p class="mb-0">Completed Today</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <h5 class="text-danger" id="failedCount">8</h5>
                                            <p class="mb-0">Failed Today</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Live Transaction Feed & Charts -->
                <div class="row">
                    <div class="col-xl-6">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title">Live Transaction Feed</h4>
                                <div class="card-action">
                                    <span class="badge badge-success">Live</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="transaction-feed" id="transactionFeed">
                                    <div class="live-transaction card mb-2">
                                        <div class="card-body p-3">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <strong>TXN-2024-789459</strong>
                                                    <small class="d-block text-muted">John Smith - bKash</small>
                                                </div>
                                                <div class="text-right">
                                                    <strong class="text-success">৳250.00</strong>
                                                    <small class="d-block status-processing">
                                                        <i class="fas fa-spinner fa-spin mr-1"></i>Processing
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="live-transaction card mb-2">
                                        <div class="card-body p-3">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <strong>TXN-2024-789458</strong>
                                                    <small class="d-block text-muted">Sarah Ahmed - SSL Commerz</small>
                                                </div>
                                                <div class="text-right">
                                                    <strong class="text-success">৳180.50</strong>
                                                    <small class="d-block status-success">
                                                        <i class="fas fa-check-circle mr-1"></i>Completed
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="live-transaction card mb-2">
                                        <div class="card-body p-3">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <strong>TXN-2024-789457</strong>
                                                    <small class="d-block text-muted">Mike Rahman - Nagad</small>
                                                </div>
                                                <div class="text-right">
                                                    <strong class="text-success">৳320.00</strong>
                                                    <small class="d-block status-failed">
                                                        <i class="fas fa-times-circle mr-1"></i>Failed
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-xl-6">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title">Real-time Processing Chart</h4>
                            </div>
                            <div class="card-body">
                                <canvas id="realtimeChart" class="realtime-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gateway Performance -->
                <div class="row">
                    <div class="col-xl-12">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title">Gateway Performance</h4>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Gateway</th>
                                                <th>Status</th>
                                                <th>Processing</th>
                                                <th>Success Rate</th>
                                                <th>Avg Time</th>
                                                <th>Volume Today</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <i class="fas fa-shield-alt text-primary mr-2"></i>
                                                    SSL Commerz
                                                </td>
                                                <td><span class="badge badge-success">Online</span></td>
                                                <td>
                                                    <div class="progress" style="height: 10px;">
                                                        <div class="progress-bar bg-success" style="width: 75%"></div>
                                                    </div>
                                                    <small>8 processing</small>
                                                </td>
                                                <td class="text-success">99.2%</td>
                                                <td>1.8s</td>
                                                <td>৳890K</td>
                                                <td>
                                                    <button class="btn btn-info btn-sm" onclick="viewGatewayDetails('sslcommerz')">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <i class="fas fa-mobile-alt text-danger mr-2"></i>
                                                    bKash
                                                </td>
                                                <td><span class="badge badge-success">Online</span></td>
                                                <td>
                                                    <div class="progress" style="height: 10px;">
                                                        <div class="progress-bar bg-warning" style="width: 40%"></div>
                                                    </div>
                                                    <small>3 processing</small>
                                                </td>
                                                <td class="text-warning">97.8%</td>
                                                <td>2.5s</td>
                                                <td>৳320K</td>
                                                <td>
                                                    <button class="btn btn-info btn-sm" onclick="viewGatewayDetails('bkash')">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <i class="fas fa-coins text-warning mr-2"></i>
                                                    Nagad
                                                </td>
                                                <td><span class="badge badge-warning">Slow</span></td>
                                                <td>
                                                    <div class="progress" style="height: 10px;">
                                                        <div class="progress-bar bg-danger" style="width: 20%"></div>
                                                    </div>
                                                    <small>1 processing</small>
                                                </td>
                                                <td class="text-danger">95.1%</td>
                                                <td>4.2s</td>
                                                <td>৳45K</td>
                                                <td>
                                                    <button class="btn btn-warning btn-sm" onclick="troubleshootGateway('nagad')">
                                                        <i class="fas fa-tools"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="copyright">
                <p>Copyright © 2024 Courier Management System. All rights reserved.</p>
            </div>
        </div>
    </div>

    <script src="../../../vendor/global/global.min.js"></script>
    <script src="../../../vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>
    <script src="../../../vendor/datatables/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../../../assets/js/custom.min.js"></script>
    <script src="../../../assets/js/deznav-init.js"></script>

    <script>
        let realtimeChart;
        let autoRefreshInterval;

        // Initialize real-time chart
        function initRealtimeChart() {
            const ctx = document.getElementById('realtimeChart').getContext('2d');
            realtimeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Transactions/min',
                        data: [],
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    scales: {
                        x: {
                            display: true,
                            title: { display: true, text: 'Time' }
                        },
                        y: {
                            display: true,
                            title: { display: true, text: 'Transactions' }
                        }
                    }
                }
            });
        }

        // Update real-time data
        function updateRealtimeData() {
            // Simulate real-time data updates
            const now = new Date().toLocaleTimeString();
            const transactions = Math.floor(Math.random() * 20) + 30;
            
            // Update chart
            if (realtimeChart.data.labels.length > 10) {
                realtimeChart.data.labels.shift();
                realtimeChart.data.datasets[0].data.shift();
            }
            
            realtimeChart.data.labels.push(now);
            realtimeChart.data.datasets[0].data.push(transactions);
            realtimeChart.update('none');

            // Update stats
            $('#liveTransactions').text(Math.floor(Math.random() * 20) + 40);
            
            // Add new transaction to feed
            addNewTransaction();
        }

        // Add new transaction to live feed
        function addNewTransaction() {
            const transactions = [
                { id: 'TXN-2024-' + Math.floor(Math.random() * 999999), customer: 'John Doe', gateway: 'bKash', amount: '৳' + (Math.random() * 500 + 100).toFixed(2) },
                { id: 'TXN-2024-' + Math.floor(Math.random() * 999999), customer: 'Jane Smith', gateway: 'SSL Commerz', amount: '৳' + (Math.random() * 500 + 100).toFixed(2) },
                { id: 'TXN-2024-' + Math.floor(Math.random() * 999999), customer: 'Mike Rahman', gateway: 'Nagad', amount: '৳' + (Math.random() * 500 + 100).toFixed(2) }
            ];
            
            const transaction = transactions[Math.floor(Math.random() * transactions.length)];
            const status = Math.random() > 0.15 ? 'success' : (Math.random() > 0.5 ? 'processing' : 'failed');
            
            const statusHTML = {
                processing: '<i class="fas fa-spinner fa-spin mr-1"></i>Processing',
                success: '<i class="fas fa-check-circle mr-1"></i>Completed',
                failed: '<i class="fas fa-times-circle mr-1"></i>Failed'
            };
            
            const newTransaction = `
                <div class="live-transaction card mb-2">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${transaction.id}</strong>
                                <small class="d-block text-muted">${transaction.customer} - ${transaction.gateway}</small>
                            </div>
                            <div class="text-right">
                                <strong class="text-success">${transaction.amount}</strong>
                                <small class="d-block status-${status}">
                                    ${statusHTML[status]}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            $('#transactionFeed').prepend(newTransaction);
            
            // Remove old transactions (keep only 10)
            $('#transactionFeed .live-transaction:gt(9)').remove();
        }

        // Control functions
        function pauseProcessing() {
            if (confirm('Pause payment processing? This will stop all new transactions.')) {
                clearInterval(autoRefreshInterval);
                alert('Payment processing paused!');
            }
        }

        function clearQueue() {
            if (confirm('Clear processing queue? This will cancel pending transactions.')) {
                $('#queueCount').text('0');
                alert('Processing queue cleared!');
            }
        }

        function forceProcess() {
            if (confirm('Force process all queued transactions?')) {
                alert('Force processing initiated!');
            }
        }

        function viewGatewayDetails(gateway) {
            alert(`Opening detailed view for ${gateway} gateway...`);
            window.open('payment-gateway.html', '_blank');
        }

        function troubleshootGateway(gateway) {
            alert(`Starting troubleshooting for ${gateway} gateway...`);
        }

        // Initialize on page load
        $(document).ready(function() {
            initRealtimeChart();
            
            // Start auto-refresh
            autoRefreshInterval = setInterval(updateRealtimeData, 10000);
            
            // Initial data update
            updateRealtimeData();
        });
    </script>
</body>
</html>